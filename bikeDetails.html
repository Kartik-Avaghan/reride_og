<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vehicle Details</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Swiper CSS -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.css"
      rel="stylesheet"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/css/bikedetails.css" />
    <link rel="stylesheet" href="/css/nav.css" />
    
  </head>

  <body>
    <header class="header">
      <div class="d-flex justify-content-between align-items-start">
        <!-- Logo -->
        <a href="index.html" class="logo">
          <img src="./images/home/Reride_Logo.png" alt="Reride Logo" />
        </a>

        <!-- Right side: Hamburger + Nav -->
        <div class="d-flex flex-column align-items-end">
          <!-- Hamburger -->
          <button class="hamburger d-lg-none ms-3" id="hamburger">
            &#9776;
          </button>

          <!-- Navigation -->
          <nav class="nav" id="navMenu">
            <ul class="nav__list">
              <!-- Search -->
              <li class="nav-item">
                <div class="search-container">
                  <input
                    type="text"
                    placeholder="Search"
                    class="nav-search-input"
                    id="indexSearch"
                  />
                  <button class="search-btn" onclick="indexSearch()">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="#fff"
                      width="16"
                      height="16"
                      viewBox="0 0 24 24"
                    >
                      <path
                        d="M10,2A8,8 0 1,0 18,10A8,8 0 0,0 10,2M22,22L17,17"
                        stroke="white"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                      />
                    </svg>
                  </button>
                </div>
              </li>
              <!-- Links -->
              <li class="nav-item">
                <a href="./index.html" class="nav-link">Home</a>
              </li>
              <li class="nav-item">
                <a href="./aboutUs.html" class="nav-link">About Us</a>
              </li>
              <li class="nav-item">
                <a href="./buy.html" class="nav-link active">Buy</a>
              </li>
              <li class="nav-item">
                <a href="./sell.html" class="nav-link">Sell</a>
              </li>
              <li class="nav-item">
                <a href="./contact.html" class="nav-link">Contact</a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <div class="vehicle-details-wrapper">
      <!-- Left: Fixed Image Gallery -->
      <div class="gallery-section">
        <div class="swiper mySwiper">
          <div class="swiper-wrapper" id="bikeImages">
            <!-- Dynamic Images will be loaded here -->
          </div>
          <div class="swiper-pagination"></div>
          <div class="swiper-button-prev"></div>
          <div class="swiper-button-next"></div>
        </div>
      </div>

      <!-- Right: Scrollable Details -->
      <div class="details-section" id="detailsContent">
        <div class="loading-spinner">
          <div class="spinner"></div>
          <p style="color: #6b7280; font-weight: 500">
            Loading vehicle details...
          </p>
        </div>
      </div>
    </div>

    <!-- Test Ride Modal -->
    <div id="testRideModal" class="modal">
      <div class="modal-container">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Schedule Test Ride</h2>
            <span class="close">&times;</span>
          </div>
          <form id="testRideForm" class="test-ride-form">
            <div class="form-group">
              <label for="trName">Name</label>
              <input
                type="text"
                id="trName"
                name="name"
                required
                class="form-control"
              />
            </div>
            <div class="form-group">
              <label for="trMobile">Mobile Number</label>
              <input
                type="tel"
                id="trMobile"
                name="mobile"
                pattern="[0-9]{10}"
                required
                class="form-control"
                placeholder="10-digit mobile number"
              />
            </div>
            <div class="form-group">
              <label for="trEmail">Email</label>
              <input
                type="email"
                id="trEmail"
                name="email"
                required
                class="form-control"
                placeholder="Email"
              />
            </div>
            <div class="form-group">
              <label for="trDate">Preferred Date</label>
              <input
                type="date"
                id="trDate"
                name="date"
                required
                class="form-control"
                min=""
              />
            </div>
            <div class="form-group">
              <label for="trTime">Preferred Time</label>
              <input
                type="time"
                id="trTime"
                name="time"
                required
                class="form-control"
              />
            </div>
            <button type="submit" class="btn-custom btn-primary-custom">
              Schedule Test Ride
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>

    <!-- Swiper JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/11.0.5/swiper-bundle.min.js"></script>

    <script>
      let swiper;

      // Get vehicle ID from URL parameter
      function getVehicleIdFromUrl() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("id");
      }

      // Fetch vehicle data from backend
      async function fetchVehicleData(vehicleId) {
        try {
          const response = await fetch(
            `http://localhost:8080/vehicle/website/getVehicle/${vehicleId}`
          );

          if (!response.ok) {
            throw new Error("Vehicle not found");
          }

          const data = await response.json();
          console.log("Fetched vehicle data:", data);
          return data;
        } catch (error) {
          console.error("Error fetching vehicle data:", error);
          throw error;
        }
      }

      // Display error message
      function displayError(message) {
        const detailsContent = document.getElementById("detailsContent");
        detailsContent.innerHTML = `
        <div class="error-message">
          <i class="fas fa-exclamation-circle"></i>
          <h3>Error Loading Vehicle</h3>
          <p>${message}</p>
        </div>
      `;
      }

      // Format date
      function formatDate(dateString) {
        if (!dateString) return "N/A";
        const date = new Date(dateString);
        return date.toLocaleDateString("en-IN", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      // Format price
      function formatPrice(price) {
        if (!price) return "N/A";
        return "₹" + parseFloat(price).toLocaleString("en-IN");
      }

      // Render vehicle details
      function renderVehicleDetails(vehicle) {
        const detailsContent = document.getElementById("detailsContent");

        const content = `
        <!-- Vehicle Header -->
        <div class="vehicle-header">
          <div class="status-badge">
            <i class="fas fa-circle"></i>
            Available
          </div>
          <h1 class="vehicle-title">${vehicle.vehicleBrand || "N/A"} ${
          vehicle.vehicleModel || ""
        }</h1>
          <p class="vehicle-subtitle">${vehicle.vehicleModelYear || "N/A"} • ${
          vehicle.vehicleColour || "N/A"
        }</p>
        </div>

        <!-- Price Section -->
        <div class="price-section">
          <div class="price-label">Vehicle Price</div>
          <div class="price-value">${formatPrice(
            vehicle.vehicleOutLetPrice
          )}</div>
        </div>

        <!-- Specifications -->
        <div class="specs-container">
          <h3 class="section-title">
            <i class="fas fa-info-circle"></i>
            Vehicle Information
          </h3>
          <div class="specs-grid">
            <div class="spec-card">
              <div class="spec-icon">
                <i class="fas fa-car"></i>
              </div>
              <div class="spec-label">Brand</div>
              <div class="spec-value">${vehicle.vehicleBrand || "N/A"}</div>
            </div>

            <div class="spec-card">
              <div class="spec-icon">
                <i class="fas fa-tag"></i>
              </div>
              <div class="spec-label">Model</div>
              <div class="spec-value">${vehicle.vehicleModel || "N/A"}</div>
            </div>

            <div class="spec-card">
              <div class="spec-icon">
                <i class="fas fa-calendar-alt"></i>
              </div>
              <div class="spec-label">Model Year</div>
              <div class="spec-value">${vehicle.vehicleModelYear || "N/A"}</div>
            </div>

            <div class="spec-card">
              <div class="spec-icon">
                <i class="fas fa-palette"></i>
              </div>
              <div class="spec-label">Colour</div>
              <div class="spec-value">${vehicle.vehicleColour || "N/A"}</div>
            </div>

            <div class="spec-card">
              <div class="spec-icon">
                <i class="fas fa-user"></i>
              </div>
              <div class="spec-label">Owner Type</div>
              <div class="spec-value">${vehicle.vehicleOwnerType || "N/A"}</div>
            </div>

            <div class="spec-card">
              <div class="spec-icon">
                <i class="fas fa-id-card"></i>
              </div>
              <div class="spec-label">Register Number</div>
              <div class="spec-value">${
                vehicle.vehicleRegisterNumber || "N/A"
              }</div>
            </div>

        </div>

        <!-- Action Buttons -->
        <div class="action-section">
          <button class="btn-custom btn-primary-custom" id="bookBtn">
            <i class="fas fa-check-circle"></i>
            Book Now
          </button>
          <button class="btn-custom btn-outline-custom" id="testRideBtn">
            <i class="fas fa-motorcycle"></i>
            Test Ride
          </button>
        </div>
      `;

        detailsContent.innerHTML = content;

        // Add button event listeners
        document
          .getElementById("bookBtn")
          .addEventListener("click", function () {
            alert("Redirecting to booking page...");
          });

        document
          .getElementById("testRideBtn")
          .addEventListener("click", function () {
            const modal = document.getElementById("testRideModal");
            modal.style.display = "block";

            // Set minimum date to today
            const today = new Date().toISOString().split("T")[0];
            document.getElementById("trDate").min = today;
          });

        // Get the test ride modal
        const modal = document.getElementById("testRideModal");
        const closeBtn = document.getElementsByClassName("close")[0];

        // Close the modal when clicking the close button
        closeBtn.onclick = function () {
          modal.style.display = "none";
        };

        // Close the modal when clicking outside of it
        window.onclick = function (event) {
          if (event.target == modal) {
            modal.style.display = "none";
          }
        };

        // Handle test ride form submission
        document
          .getElementById("testRideForm")
          .addEventListener("submit", function (e) {
            e.preventDefault();
            // You can add your form submission logic here
            const formData = {
              testRideCustomerName: document.getElementById("trName").value,
              testRideCustomerEmail: document.getElementById("trEmail").value,
              testRideCustomerPhoneNo:
                document.getElementById("trMobile").value,
              testRideDate: document.getElementById("trDate").value,
              testRideTime: document.getElementById("trTime").value,
              vehicle: {
                vehicleId: vehicle.vehicleId,
              },
            };

            console.log("Test ride form data:", formData);

            try {
              fetch("http://localhost:8080/testRide/bookTestRide", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(formData),
              })
                .then((response) => {
                  if (!response.ok) {
                    throw new Error("Network response was not ok");
                  }
                  return response.json();
                })
                .then((data) => {
                  console.log("Success:", data);
                  alert("Test ride request submitted successfully!");
                })
                .catch((error) => {
                  console.error("Error:", error);
                });
            } catch (error) {
              console.log("Error submitting test ride request");
            }

            modal.style.display = "none";
          });
      }

      // Load vehicle images
      function loadVehicleImages(vehicle) {
        const imagesContainer = document.getElementById("bikeImages");
        let images = JSON.parse(vehicle.vehicleImage);
        console.log("Vehicle images:", images);
        // Check if vehicle has images
        if (images && images.length > 0) {
          imagesContainer.innerHTML = images
            .map(
              (imageUrl) => `
          <div class="swiper-slide">
            <img src="http://localhost:8080/uploads/${imageUrl}" alt="Vehicle Image" ">
          </div>
        `
            )
            .join("");
        }

        // Initialize Swiper after images are loaded
        if (swiper) {
          swiper.destroy();
        }

        swiper = new Swiper(".mySwiper", {
          loop: vehicle.images && vehicle.images.length > 1,
          pagination: {
            el: ".swiper-pagination",
            clickable: true,
          },
          navigation: {
            nextEl: ".swiper-button-next",
            prevEl: ".swiper-button-prev",
          },
          autoplay:
            images && images.length > 1
              ? {
                  delay: 3500,
                  disableOnInteraction: false,
                }
              : false,
        });
      }

      // Dummy data for testing
      const dummyVehicleData = {
        vehicleBrand: "Royal Enfield",
        vehicleModel: "Classic 350",
        vehicleModelYear: "2024",
        vehicleColour: "Stealth Black",
        vehiclePurchasedDate: "2024-03-15",
        price: 245000,
        vehicleOwnerType: "First Owner",
        vehicleRegisterNumber: "KA-05-MN-1234",
        images: [
          "https://images.unsplash.com/photo-1558981403-c5f9899a28bc?w=1200&h=800&fit=crop",
          "https://images.unsplash.com/photo-1568772585407-9361f9bf3a87?w=1200&h=800&fit=crop",
          "https://images.unsplash.com/photo-1558980664-769d59546b3d?w=1200&h=800&fit=crop",
          "https://images.unsplash.com/photo-1449426468159-d96dbf08f19f?w=1200&h=800&fit=crop",
        ],
      };

      // Initialize page
      async function initializePage() {
        const vehicleId = getVehicleIdFromUrl();

        if (!vehicleId) {
          displayError(
            "No vehicle ID provided in URL. Please add ?id=YOUR_VEHICLE_ID to the URL."
          );
          return;
        }

        try {
          const vehicleData = await fetchVehicleData(vehicleId);
          loadVehicleImages(vehicleData);
          renderVehicleDetails(vehicleData);
        } catch (error) {
          displayError(
            "Unable to load vehicle details. Please check if the vehicle ID is correct and the server is running."
          );
        }
      }

      // Load data when page loads
      document.addEventListener("DOMContentLoaded", initializePage);
    </script>

  </body>

</html>
